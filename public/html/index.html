
<!DOCTYPE HTML>
<html lang="en-GB">
	<head>

		<meta charset="utf-8" />
		<title>engram - minimal bookmarking.</title>

		<meta name="description" content="minimal search engine.">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

	</head>






	<style type="text/css">

	html {
		font-family: 'Sans';
		color:       '#00F';
	}

	ul {
		list-style-type: none;
	}

	a {
		text-decoration: none;
	}

	article {
		margin: 60px;
	}

	</style>

<body>

	<main>

		{{#bookmarks}}

			<article id={{bookmark_id}}>
				<ul>

					<li><a href="{{url}}">{{title}}</a> | <a href="{{hosturl}}">{{hostname}}</a></li>
					<li><time data-ctime="{{ctime}}">{{ctime}}</time></li>
					<li>
						<a href="http://www.twitter.com/share?url={{url}}">&#x1f381</a> |
						<a href="http://www.twitter.com/share?url={{url}}">&#x1F5C3</a> |
						<a id="delete-bookmark">&#x2716</a>

					</li>

				</ul>
			</article>

		{{/bookmarks}}

	</main>

</body>


<script type="text/javascript">

const constants = {
	months: [
		"Jan", "Feb",
		"Mar", "Apr",
		"May", "Jun",
		"Jul", "Aug",
		"Sep", "Oct",
		"Nov", "Dec"
	],
	second: 1,
	minute: 60,
	hour:   3600,
	day:    24 * 3600

}





const extractTime = function (timeTag)  {

	const ctime = $(timeTag).attr('data-ctime')
	return new Date(parseInt(ctime, 10) * 1000)

}

// todo add event listeners to seconds range, and loop over rest,
// use data to give update rate.

const formatTime = function (ith, val) {

	const now        = new Date
	const ctime      = extractTime(val)
	const secondsAgo = Math.floor((now.getTime() - ctime.getTime() ) / 1000)

	if (secondsAgo == 1) {

		$(this).text('just now')

	} else if (secondsAgo < constants.minute) {

		$(this).text(secondsAgo + 's')

	} else if (secondsAgo < constants.hour) {

		$(this).text(Math.floor(secondsAgo / constants.minute) + 'm')

	} else if (secondsAgo < constants.day) {

		$(this).text(Math.floor(secondsAgo / constants.hour) + 'h')

	} else {

		$(this).text(months[ctime.getMonth()] + " " + ctime.getDate())

	}

}

const delete_bookmark = function () {

	console.log("running")

	const id = $(this).closest('article').attr('id')

	console.log(id)

	$.ajax({
		url:  '~/bookmarks/id',
		type: 'DELETE',
		success: function (response) {

		}
	})

}




$(function() {

	const times = $("time")

	const updateTime = function () {
		times.each(formatTime)
	}

	updateTime()
	const pid = setInterval(updateTime, 5000)

	$('#delete-bookmark').click(delete_bookmark)

})

</script>

</html>
